# 第七章：进程间通信

## 目录

1. [引言](0intro.md)
2. [管道](1pipe.md)
3. [命令行参数与标准 I/O 重定向](2cmdargs-and-redirection.md)
4. [练习](3exercise.md)

## 本章目标

本章的目标是实现进程间通信机制（管道），并扩展 shell 程序，支持命令行参数和 I/O 重定向。

## 主要内容

1. **管道机制**：实现 `sys_pipe`，支持父子进程间单向通信
2. **命令行参数**：扩展 `sys_exec`，支持传递命令行参数（`argc`、`argv`）
3. **I/O 重定向**：实现 `sys_dup`，支持标准输入/输出重定向（`<`、`>`）
4. **信号机制**：引入信号模块，支持进程间信号通信（`kill`、`sigaction`、`sigprocmask`、`sigreturn`）

## 代码位置

本章的代码位于 `rCore-Tutorial-in-single-workspace/ch7/` 目录下。

主要文件：
- `src/main.rs` - 内核主函数（含信号初始化）
- `src/fs.rs` - 文件系统封装
- `src/process.rs` - 进程管理（含信号处理）
- `src/processor.rs` - 处理器管理
- `src/virtio_block.rs` - VirtIO 块设备驱动

主要依赖库：
- `signal` - 信号模块定义
- `signal-impl` - 信号模块实现
- `signal-defs` - 信号定义（用户与内核共享）
- `syscall` - 系统调用处理（含信号相关 syscall）
- `easy-fs` - 文件系统
- `rcore-task-manage` - 任务管理库

## 运行方法

```bash
$ cd ch7
$ cargo run
```

运行后会进入 Shell 界面，可以测试管道、命令行参数和重定向功能。

## 关键概念

- **管道（Pipe）**：基于循环缓冲区的单向通信机制，通过文件描述符访问
- **命令行参数**：通过 `exec` 传递，在用户栈上组织为 `argv` 数组
- **文件描述符复制**：`dup` 系统调用，用于实现重定向
- **信号（Signal）**：进程间异步通知机制

## 与第六章的对比

| 特性 | 第六章 | 第七章 |
|------|--------|--------|
| 文件类型 | 标准 I/O、普通文件 | 新增管道 |
| exec 参数 | 仅程序路径 | 支持命令行参数 |
| I/O 重定向 | 无 | 支持 `<`、`>` |
| 进程通信 | 无 | 支持管道和信号 |

## 注意事项

- 实验指导书存在的目的是帮助读者理解框架代码
- 为便于测试，完成编程实验时，请以框架代码为基础，不必跟着文档从零开始编写内核
- 本章主要实现了管道和重定向功能，信号机制可能还有待完善
- 本章的问答作业需要和 ch6 一并完成，并一同交到 ch6 分支
